<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Math Apps Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root { --card:#fff; --bg:#f4f6f8; --ink:#111827; --muted:#6b7280; --blue:#2563eb; --line:#d1d5db; }
    body { margin:0; padding:20px; font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif; background:var(--bg); color:var(--ink); }
    .wrap { max-width: 1120px; margin: 0 auto; }
    .card { background:var(--card); border-radius:14px; padding:18px 18px 16px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
    h1 { margin: 0 0 6px; font-size: 1.45rem; }
    .sub { margin: 0 0 14px; color: var(--muted); }

    .course-grid {
      display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:12px; margin-top:12px;
    }
    .course-card {
      border:1px solid var(--line); border-radius:14px; padding:14px; background:#fff;
      display:flex; flex-direction:column; gap:10px;
    }
    .course-card h2 { margin:0; font-size:1.1rem; }
    .course-card p { margin:0; color:var(--muted); font-size:.95rem; line-height:1.3; }

    .toolbar { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-top:8px; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#1f2a6d; font-weight:800; }

    button {
      padding:10px 14px; font-size:1rem; border-radius:10px; border:none;
      background: var(--blue); color:#fff; cursor:pointer; font-weight:800;
    }
    button:hover { filter: brightness(.95); }
    .btn-ghost { background:#fff; color:var(--ink); border:1px solid var(--line); }
    .btn-ghost:hover { filter:none; background:#f9fafb; }

    .tabs { display:flex; gap:8px; flex-wrap:wrap; margin: 12px 0 14px; }
    .tabbtn { border:1px solid var(--line); background:#fff; color:var(--ink); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:700; }
    .tabbtn.active { background: var(--blue); color:#fff; border-color:var(--blue); }

    .panel { display:none; }
    .panel.active { display:block; }

    .row { display:flex; gap:16px; flex-wrap:wrap; align-items:flex-start; }
    .box { flex: 1 1 480px; border:1px solid var(--line); border-radius:12px; padding:14px; }
    .boxtitle { margin: 0 0 10px; font-size: 1.05rem; }

    label { font-size: .9rem; color: var(--muted); display:block; margin: 10px 0 6px; }
    input[type="number"], input[type="text"] {
      width:100%; box-sizing:border-box; padding:10px; border:1px solid var(--line); border-radius:10px; font-size:1rem;
    }

    .grid2 { display:grid; grid-template-columns: repeat(2, 120px); gap:10px; }
    .grid3 { display:grid; grid-template-columns: repeat(3, 120px); gap:10px; }
    .actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top: 10px; }

    .out {
      margin-top:12px; background:#f1f5f9; padding:12px; border-radius:12px; overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: .95rem;
      white-space: pre-wrap;
    }

    .screen { display:none; }
    .screen.active { display:block; }
  </style>

  <!-- Nerdamer (symbolic algebra + calculus) -->
  <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/all.min.js"></script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Math Apps Hub</h1>
      <p class="sub">Select your course.</p>

      <!-- SCREEN 1: COURSE PICKER -->
      <div id="screen-course" class="screen active">
        <div class="course-grid">
          <div class="course-card">
            <h2>MAT225</h2>
            <p>Eigenvalues & eigenvectors (2×2, 3×3).</p>
            <div style="margin-top:auto;">
              <button onclick="selectCourse('MAT225')">Open MAT225</button>
            </div>
          </div>

          <div class="course-card">
            <h2>MAT227</h2>
            <p>Quadratic roots + 2×2 linear systems.</p>
            <div style="margin-top:auto;">
              <button onclick="selectCourse('MAT227')">Open MAT227</button>
            </div>
          </div>

          <div class="course-card">
            <h2>MAT276</h2>
            <p>Eigen, systems, equilibrium points, integrals, partial derivatives.</p>
            <div style="margin-top:auto;">
              <button onclick="selectCourse('MAT276')">Open MAT276</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 2: COURSE CONTENT -->
      <div id="screen-apps" class="screen">
        <div class="toolbar">
          <span class="pill" id="course-pill">Course</span>
          <button class="btn-ghost" onclick="goHome()">Change course</button>
        </div>

        <!-- =========================
             MAT225
        ========================= -->
        <div id="course-MAT225" class="course-tools" style="display:none; margin-top:12px;">
          <div class="tabs">
            <button class="tabbtn active" data-course="MAT225" data-tab="eigen2">Eigen (2×2)</button>
            <button class="tabbtn" data-course="MAT225" data-tab="eigen3">Eigen (3×3)</button>
          </div>

          <div class="panel active" id="MAT225-panel-eigen2">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">2×2 Eigenvalues & Eigenvectors</h2>
                <label>Matrix A = [[a, b], [c, d]]</label>
                <div class="grid2">
                  <input id="MAT225_e2_a" type="number" step="any" value="2" />
                  <input id="MAT225_e2_b" type="number" step="any" value="1" />
                  <input id="MAT225_e2_c" type="number" step="any" value="1" />
                  <input id="MAT225_e2_d" type="number" step="any" value="2" />
                </div>
                <div class="actions">
                  <button id="MAT225_e2_compute">Compute</button>
                </div>
                <div class="out" id="MAT225_e2_out"></div>
              </div>
            </div>
          </div>

          <div class="panel" id="MAT225-panel-eigen3">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">3×3 Eigenvalues & Eigenvectors</h2>

                <label>Matrix A (3×3)</label>
                <div class="grid3">
                  <input id="MAT225_e3_a11" type="number" step="any" value="3" />
                  <input id="MAT225_e3_a12" type="number" step="any" value="0" />
                  <input id="MAT225_e3_a13" type="number" step="any" value="0" />
                  <input id="MAT225_e3_a21" type="number" step="any" value="0" />
                  <input id="MAT225_e3_a22" type="number" step="any" value="2" />
                  <input id="MAT225_e3_a23" type="number" step="any" value="1" />
                  <input id="MAT225_e3_a31" type="number" step="any" value="0" />
                  <input id="MAT225_e3_a32" type="number" step="any" value="1" />
                  <input id="MAT225_e3_a33" type="number" step="any" value="2" />
                </div>

                <div class="actions">
                  <button id="MAT225_e3_compute">Compute</button>
                </div>

                <div class="out" id="MAT225_e3_out"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- =========================
             MAT227
        ========================= -->
        <div id="course-MAT227" class="course-tools" style="display:none; margin-top:12px;">
          <div class="tabs">
            <button class="tabbtn active" data-course="MAT227" data-tab="quad">Quadratic Roots</button>
            <button class="tabbtn" data-course="MAT227" data-tab="linear2">Linear System (2×2)</button>
          </div>

          <div class="panel active" id="MAT227-panel-quad">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Solve x² = a x + b</h2>

                <label>a</label>
                <input id="MAT227_q_a" type="number" step="any" value="1" />
                <label>b</label>
                <input id="MAT227_q_b" type="number" step="any" value="1" />

                <div class="actions">
                  <button id="MAT227_q_compute">Compute</button>
                </div>

                <div class="out" id="MAT227_q_out"></div>
              </div>
            </div>
          </div>

          <div class="panel" id="MAT227-panel-linear2">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Solve a 2×2 Linear System</h2>

                <label>Equation 1: a₁x + b₁y = c₁</label>
                <div class="grid3">
                  <input id="MAT227_l_a1" type="number" step="any" value="1" />
                  <input id="MAT227_l_b1" type="number" step="any" value="1" />
                  <input id="MAT227_l_c1" type="number" step="any" value="4" />
                </div>

                <label>Equation 2: a₂x + b₂y = c₂</label>
                <div class="grid3">
                  <input id="MAT227_l_a2" type="number" step="any" value="2" />
                  <input id="MAT227_l_b2" type="number" step="any" value="-1" />
                  <input id="MAT227_l_c2" type="number" step="any" value="1" />
                </div>

                <div class="actions">
                  <button id="MAT227_l_solve">Solve</button>
                </div>

                <div class="out" id="MAT227_l_out"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- =========================
             MAT276
        ========================= -->
        <div id="course-MAT276" class="course-tools" style="display:none; margin-top:12px;">
          <div class="tabs">
            <button class="tabbtn active" data-course="MAT276" data-tab="eigen2">Eigen (2×2)</button>
            <button class="tabbtn" data-course="MAT276" data-tab="linear2">Linear System (2×2)</button>
            <button class="tabbtn" data-course="MAT276" data-tab="equilibrium">Equilibrium Points</button>
            <button class="tabbtn" data-course="MAT276" data-tab="integral">Indefinite Integral</button>
            <button class="tabbtn" data-course="MAT276" data-tab="partials">Partial Derivatives</button>
          </div>

          <!-- MAT276 • Eigen 2×2 -->
          <div class="panel active" id="MAT276-panel-eigen2">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">2×2 Eigenvalues & Eigenvectors</h2>
                <label>Matrix A = [[a, b], [c, d]]</label>
                <div class="grid2">
                  <input id="MAT276_e2_a" type="number" step="any" value="2" />
                  <input id="MAT276_e2_b" type="number" step="any" value="1" />
                  <input id="MAT276_e2_c" type="number" step="any" value="1" />
                  <input id="MAT276_e2_d" type="number" step="any" value="2" />
                </div>
                <div class="actions">
                  <button id="MAT276_e2_compute">Compute</button>
                </div>
                <div class="out" id="MAT276_e2_out"></div>
              </div>
            </div>
          </div>

          <!-- MAT276 • Linear 2×2 -->
          <div class="panel" id="MAT276-panel-linear2">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Solve a 2×2 Linear System</h2>

                <label>Equation 1: a₁x + b₁y = c₁</label>
                <div class="grid3">
                  <input id="MAT276_l_a1" type="number" step="any" value="1" />
                  <input id="MAT276_l_b1" type="number" step="any" value="1" />
                  <input id="MAT276_l_c1" type="number" step="any" value="4" />
                </div>

                <label>Equation 2: a₂x + b₂y = c₂</label>
                <div class="grid3">
                  <input id="MAT276_l_a2" type="number" step="any" value="2" />
                  <input id="MAT276_l_b2" type="number" step="any" value="-1" />
                  <input id="MAT276_l_c2" type="number" step="any" value="1" />
                </div>

                <div class="actions">
                  <button id="MAT276_l_solve">Solve</button>
                </div>

                <div class="out" id="MAT276_l_out"></div>
              </div>
            </div>
          </div>

          <!-- MAT276 • Equilibrium Points (formerly Nonlinear Roots) -->
          <div class="panel" id="MAT276-panel-equilibrium">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Equilibrium Points</h2>

                <label>f(x, y) = 0</label>
                <input id="MAT276_n_f" type="text" value="x*x + y*y - 1" />

                <label>g(x, y) = 0</label>
                <input id="MAT276_n_g" type="text" value="y - x" />

                <div class="actions">
                  <button id="MAT276_n_find">Find</button>
                </div>

                <div class="out" id="MAT276_n_out"></div>
              </div>
            </div>
          </div>

          <!-- MAT276 • Integral -->
          <div class="panel" id="MAT276-panel-integral">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Indefinite Integral</h2>

                <label>∫ f(t) dt</label>
                <input id="MAT276_i_expr" type="text" value="t^3 - 4*t + sin(t)" />

                <div class="actions">
                  <button id="MAT276_i_integrate">Integrate</button>
                </div>

                <div class="out" id="MAT276_i_out"></div>
              </div>
            </div>
          </div>

          <!-- MAT276 • Partial Derivatives (clean UI: input only) -->
          <div class="panel" id="MAT276-panel-partials">
            <div class="row">
              <div class="box">
                <h2 class="boxtitle">Partial Derivatives</h2>

                <label>f(x, y)</label>
                <input id="MAT276_pd_expr" type="text" value="x^2*y + sin(x*y)" />

                <div class="actions">
                  <button id="MAT276_pd_compute">Compute</button>
                </div>

                <div class="out" id="MAT276_pd_out"></div>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /screen-apps -->
    </div><!-- /card -->
  </div><!-- /wrap -->

<script>
/* =========================
   Helpers
========================= */
const $ = (id) => document.getElementById(id);
function isFiniteAll(arr){ return arr.every(Number.isFinite); }

/* =========================
   Course switching
========================= */
function showScreen(which){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(which).classList.add("active");
}
function hideAllCourses(){
  ["MAT225","MAT227","MAT276"].forEach(c => {
    const el = document.getElementById("course-" + c);
    if (el) el.style.display = "none";
  });
}
function selectCourse(course){
  hideAllCourses();
  $("course-pill").textContent = course;
  const el = document.getElementById("course-" + course);
  if (el) el.style.display = "block";
  showScreen("screen-apps");

  const url = new URL(window.location.href);
  url.searchParams.set("course", course);
  history.replaceState({}, "", url.toString());

  // optional: pre-fill outputs
  if (course === "MAT225") { MAT225_eigen2(); MAT225_eigen3(); }
  if (course === "MAT227") { MAT227_quadratic(); MAT227_linear2(); }
  if (course === "MAT276") { MAT276_eigen2(); MAT276_linear2(); MAT276_equilibrium(); MAT276_integral(); MAT276_partials(); }
}
function goHome(){
  const url = new URL(window.location.href);
  url.searchParams.delete("course");
  history.replaceState({}, "", url.toString());
  showScreen("screen-course");
}

/* Auto-select via URL: ?course=MAT276 */
(function initFromURL(){
  const course = new URL(window.location.href).searchParams.get("course");
  if (course && ["MAT225","MAT227","MAT276"].includes(course)) selectCourse(course);
})();

/* =========================
   Tabs (per-course)
========================= */
document.addEventListener("click", (ev) => {
  const btn = ev.target;
  if (!btn || !btn.classList || !btn.classList.contains("tabbtn")) return;

  const course = btn.dataset.course;
  const tab = btn.dataset.tab;
  if (!course || !tab) return;

  document.querySelectorAll(`#course-${course} .tabbtn`).forEach(b => b.classList.remove("active"));
  document.querySelectorAll(`#course-${course} .panel`).forEach(p => p.classList.remove("active"));
  btn.classList.add("active");

  const panelId = `${course}-panel-${tab}`;
  const panel = document.getElementById(panelId);
  if (panel) panel.classList.add("active");
});

/* =========================
   Complex arithmetic
========================= */
function complex(re, im=0){ return {re, im}; }
function cAdd(x,y){ return complex(x.re+y.re, x.im+y.im); }
function cSub(x,y){ return complex(x.re-y.re, x.im-y.im); }
function cMul(x,y){ return complex(x.re*y.re - x.im*y.im, x.re*y.im + x.im*y.re); }
function cDiv(x,y){
  const den = y.re*y.re + y.im*y.im;
  return complex((x.re*y.re + x.im*y.im)/den, (x.im*y.re - x.re*y.im)/den);
}
function cAbs(x){ return Math.hypot(x.re, x.im); }
function cIsZero(x, eps=1e-12){ return cAbs(x) < eps; }

function fmtComplex(z, digits=6){
  const re = Math.abs(z.re) < 1e-12 ? 0 : z.re;
  const im = Math.abs(z.im) < 1e-12 ? 0 : z.im;
  if (im === 0) return `${re.toFixed(digits).replace(/\.?0+$/,"")}`;
  const sign = im >= 0 ? "+" : "-";
  return `${re.toFixed(digits).replace(/\.?0+$/,"")} ${sign} ${Math.abs(im).toFixed(digits).replace(/\.?0+$/,"")}i`;
}
function fmtVecComplex(v){
  const allReal = v.every(z => Math.abs(z.im) < 1e-12);
  if (allReal) {
    const xs = v.map(z => (Math.abs(z.re) < 1e-12 ? 0 : z.re).toFixed(6));
    return `(${xs.join(", ")})`;
  }
  let maxIdx = 0;
  for (let i=1;i<v.length;i++) if (cAbs(v[i]) > cAbs(v[maxIdx])) maxIdx = i;
  const scale = cIsZero(v[maxIdx]) ? complex(1,0) : v[maxIdx];
  const vv = v.map(z => cDiv(z, scale));
  return `(${vv.map(z => fmtComplex(z)).join(", ")})`;
}

/* =========================
   2×2 eigen helper
========================= */
function eigen2x2(a,b,c,d){
  const tr = a + d;
  const det = a*d - b*c;
  const disc = tr*tr - 4*det;

  const sqrtDisc = disc >= 0 ? complex(Math.sqrt(disc), 0) : complex(0, Math.sqrt(-disc));
  const halfTr = complex(tr/2, 0);
  const halfS  = cMul(sqrtDisc, complex(0.5,0));

  const lam1 = cAdd(halfTr, halfS);
  const lam2 = cSub(halfTr, halfS);

  function eigenvector2x2(lam){
    const aa = cSub(complex(a,0), lam);
    const dd = cSub(complex(d,0), lam);
    const bb = complex(b,0);
    const cc = complex(c,0);

    const r1 = cAbs(aa) + cAbs(bb);
    const r2 = cAbs(cc) + cAbs(dd);

    let x,y;
    if (r1 >= r2) { x = cMul(complex(-1,0), bb); y = aa; }
    else { x = cMul(complex(-1,0), dd); y = cc; }

    if (cIsZero(x) && cIsZero(y)) return [complex(1,0), complex(0,0)];
    return [x,y];
  }

  return { tr, det, disc, lam1, lam2, v1: eigenvector2x2(lam1), v2: eigenvector2x2(lam2) };
}

/* =========================
   3×3 eigen (Cardano cubic + row-cross eigenvector)
========================= */
function det3(A){
  const [[a,b,c],[d,e,f],[g,h,i]] = A;
  return a*(e*i - f*h) - b*(d*i - f*g) + c*(d*h - e*g);
}
function mul3(A,B){
  const C = Array.from({length:3}, ()=>[0,0,0]);
  for (let r=0;r<3;r++) for (let c=0;c<3;c++){
    let s = 0;
    for (let k=0;k<3;k++) s += A[r][k]*B[k][c];
    C[r][c]=s;
  }
  return C;
}
function tr3(A){ return A[0][0] + A[1][1] + A[2][2]; }
function trA2(A){ return tr3(mul3(A,A)); }
function realCbrt(x){ return x >= 0 ? Math.pow(x, 1/3) : -Math.pow(-x, 1/3); }
function cubicRootsRealCoeffs(t, s, d){
  // λ^3 - t λ^2 + s λ - d = 0  (real coefficients)
  const a = -t, b = s, c = -d;
  const p = b - a*a/3;
  const q = 2*a*a*a/27 - a*b/3 + c;
  const halfQ = q/2;
  const thirdP = p/3;
  const Delta = halfQ*halfQ + thirdP*thirdP*thirdP;

  if (Delta >= 0) {
    const sqrtD = Math.sqrt(Delta);
    const u = realCbrt(-halfQ + sqrtD);
    const v = realCbrt(-halfQ - sqrtD);
    const u1 = u+v;

    const re2 = -(u+v)/2;
    const im2 = (Math.sqrt(3)/2)*(u - v);

    return [
      complex(u1 - a/3, 0),
      complex(re2 - a/3, im2),
      complex(re2 - a/3, -im2)
    ];
  } else {
    const r = Math.sqrt(-thirdP);
    const phi = Math.acos((-halfQ)/(r*r*r));
    const x1 = 2*r*Math.cos(phi/3) - a/3;
    const x2 = 2*r*Math.cos((phi + 2*Math.PI)/3) - a/3;
    const x3 = 2*r*Math.cos((phi + 4*Math.PI)/3) - a/3;
    return [complex(x1,0), complex(x2,0), complex(x3,0)];
  }
}
function rowCrossEigenvector3(A, lam){
  const M = [
    [cSub(complex(A[0][0],0), lam), complex(A[0][1],0),            complex(A[0][2],0)],
    [complex(A[1][0],0),            cSub(complex(A[1][1],0), lam), complex(A[1][2],0)],
    [complex(A[2][0],0),            complex(A[2][1],0),            cSub(complex(A[2][2],0), lam)]
  ];
  function rowNorm(r){ return cAbs(r[0]) + cAbs(r[1]) + cAbs(r[2]); }
  const idx = [0,1,2].sort((i,j)=>rowNorm(M[j]) - rowNorm(M[i]));
  const pairs = [[idx[0],idx[1]],[idx[0],idx[2]],[idx[1],idx[2]]];

  function cross(u,v){
    return [
      cSub(cMul(u[1], v[2]), cMul(u[2], v[1])),
      cSub(cMul(u[2], v[0]), cMul(u[0], v[2])),
      cSub(cMul(u[0], v[1]), cMul(u[1], v[0]))
    ];
  }
  for (const [i,j] of pairs){
    const w = cross(M[i], M[j]);
    if (!cIsZero(w[0],1e-10) || !cIsZero(w[1],1e-10) || !cIsZero(w[2],1e-10)) return w;
  }
  return [complex(1,0), complex(0,0), complex(0,0)];
}

/* =========================
   MAT225
========================= */
function MAT225_eigen2(){
  if (!$("MAT225_e2_a")) return;
  const a = parseFloat($("MAT225_e2_a").value);
  const b = parseFloat($("MAT225_e2_b").value);
  const c = parseFloat($("MAT225_e2_c").value);
  const d = parseFloat($("MAT225_e2_d").value);
  if (!isFiniteAll([a,b,c,d])) { $("MAT225_e2_out").textContent = "Invalid input."; return; }

  const R = eigen2x2(a,b,c,d);
  $("MAT225_e2_out").textContent =
`A = [[${a}, ${b}], [${c}, ${d}]]

λ1 = ${fmtComplex(R.lam1)}
v1 = ${fmtVecComplex(R.v1)}

λ2 = ${fmtComplex(R.lam2)}
v2 = ${fmtVecComplex(R.v2)}`;
}
function MAT225_eigen3(){
  if (!$("MAT225_e3_a11")) return;
  const A = [
    [parseFloat($("MAT225_e3_a11").value), parseFloat($("MAT225_e3_a12").value), parseFloat($("MAT225_e3_a13").value)],
    [parseFloat($("MAT225_e3_a21").value), parseFloat($("MAT225_e3_a22").value), parseFloat($("MAT225_e3_a23").value)],
    [parseFloat($("MAT225_e3_a31").value), parseFloat($("MAT225_e3_a32").value), parseFloat($("MAT225_e3_a33").value)]
  ];
  if (!A.flat().every(Number.isFinite)) { $("MAT225_e3_out").textContent = "Invalid input."; return; }

  const t = tr3(A);
  const s = 0.5*(t*t - trA2(A));
  const d = det3(A);

  const lambdas = cubicRootsRealCoeffs(t, s, d);
  const vecs = lambdas.map(lam => rowCrossEigenvector3(A, lam));

  let out = `A =
  [${A[0].join(", ")}]
  [${A[1].join(", ")}]
  [${A[2].join(", ")}]\n\n`;

  for (let k=0;k<3;k++){
    out += `λ${k+1} = ${fmtComplex(lambdas[k])}\n`;
    out += `v${k+1} = ${fmtVecComplex(vecs[k])}\n\n`;
  }
  $("MAT225_e3_out").textContent = out.trim();
}

/* =========================
   MAT227
========================= */
function MAT227_quadratic(){
  if (!$("MAT227_q_a")) return;
  const a = parseFloat($("MAT227_q_a").value);
  const b = parseFloat($("MAT227_q_b").value);
  if (!isFiniteAll([a,b])) { $("MAT227_q_out").textContent = "Invalid input."; return; }

  const disc = a*a + 4*b;
  let r1, r2;
  if (disc >= 0) {
    const s = Math.sqrt(disc);
    r1 = complex((a + s)/2, 0);
    r2 = complex((a - s)/2, 0);
  } else {
    const s = Math.sqrt(-disc);
    r1 = complex(a/2,  s/2);
    r2 = complex(a/2, -s/2);
  }

  $("MAT227_q_out").textContent =
`x1 = ${fmtComplex(r1)}
x2 = ${fmtComplex(r2)}`;
}
function linear2_solve(prefix){
  const a1 = parseFloat($(prefix+"_a1").value);
  const b1 = parseFloat($(prefix+"_b1").value);
  const c1 = parseFloat($(prefix+"_c1").value);
  const a2 = parseFloat($(prefix+"_a2").value);
  const b2 = parseFloat($(prefix+"_b2").value);
  const c2 = parseFloat($(prefix+"_c2").value);

  if (!isFiniteAll([a1,b1,c1,a2,b2,c2])) return "Invalid input.";

  const det = a1*b2 - a2*b1;
  const eps = 1e-12;

  if (Math.abs(det) > eps) {
    const x = (c1*b2 - c2*b1) / det;
    const y = (a1*c2 - a2*c1) / det;
    return `x = ${x.toFixed(10).replace(/\.?0+$/,"")}\ny = ${y.toFixed(10).replace(/\.?0+$/,"")}`;
  }

  // det = 0: none or infinitely many
  function isZero(z){ return Math.abs(z) < eps; }
  const r1 = [a1,b1,c1], r2 = [a2,b2,c2];

  let k = null;
  for (let i=0;i<3;i++){ if (!isZero(r1[i])) { k = r2[i]/r1[i]; break; } }

  if (k === null) {
    return isZero(c1) ? "Infinitely many solutions." : "No solution.";
  }

  const proportional =
    Math.abs(r2[0] - k*r1[0]) < 1e-9 &&
    Math.abs(r2[1] - k*r1[1]) < 1e-9 &&
    Math.abs(r2[2] - k*r1[2]) < 1e-9;

  return proportional ? "Infinitely many solutions." : "No solution.";
}
function MAT227_linear2(){
  if (!$("MAT227_l_a1")) return;
  $("MAT227_l_out").textContent = linear2_solve("MAT227_l");
}

/* =========================
   MAT276
========================= */
function MAT276_eigen2(){
  if (!$("MAT276_e2_a")) return;
  const a = parseFloat($("MAT276_e2_a").value);
  const b = parseFloat($("MAT276_e2_b").value);
  const c = parseFloat($("MAT276_e2_c").value);
  const d = parseFloat($("MAT276_e2_d").value);
  if (!isFiniteAll([a,b,c,d])) { $("MAT276_e2_out").textContent = "Invalid input."; return; }

  const R = eigen2x2(a,b,c,d);
  $("MAT276_e2_out").textContent =
`A = [[${a}, ${b}], [${c}, ${d}]]

λ1 = ${fmtComplex(R.lam1)}
v1 = ${fmtVecComplex(R.v1)}

λ2 = ${fmtComplex(R.lam2)}
v2 = ${fmtVecComplex(R.v2)}`;
}
function MAT276_linear2(){
  if (!$("MAT276_l_a1")) return;
  $("MAT276_l_out").textContent = linear2_solve("MAT276_l");
}

/* Equilibrium Points (numerical) */
function makeSafeFunction(expr){
  const body = `
    "use strict";
    const {
      abs, acos, asin, atan, atan2, ceil, cos, exp, floor, log,
      max, min, pow, round, sin, sqrt, tan, PI, E
    } = Math;
    return (${expr});
  `;
  return new Function("x","y", body);
}
function newton2D(f, g, x0, y0, maxIters, tol){
  let x = x0, y = y0;
  const h = 1e-6;

  for (let k=0; k<maxIters; k++){
    const F = f(x,y), G = g(x,y);
    const r = Math.hypot(F,G);
    if (!Number.isFinite(r)) return null;
    if (r < tol) return {x, y, r, iters:k};

    const Fx = (f(x+h, y) - f(x-h, y)) / (2*h);
    const Fy = (f(x, y+h) - f(x, y-h)) / (2*h);
    const Gx = (g(x+h, y) - g(x-h, y)) / (2*h);
    const Gy = (g(x, y+h) - g(x, y-h)) / (2*h);

    const detJ = Fx*Gy - Fy*Gx;
    if (!Number.isFinite(detJ) || Math.abs(detJ) < 1e-14) return null;

    const dx = (-F*Gy + Fy*G) / detJ;
    const dy = ( -Fx*G + F*Gx) / detJ;

    const step = Math.hypot(dx,dy);
    const alpha = step > 1 ? 1/step : 1;

    x += alpha*dx;
    y += alpha*dy;
    if (!Number.isFinite(x) || !Number.isFinite(y)) return null;
  }

  const rFinal = Math.hypot(f(x,y), g(x,y));
  if (Number.isFinite(rFinal) && rFinal < tol) return {x, y, r:rFinal, iters:maxIters};
  return null;
}
function dedupPush(roots, cand, eps){
  for (const r of roots){
    if (Math.hypot(r.x - cand.x, r.y - cand.y) < eps) return false;
  }
  roots.push(cand);
  return true;
}
function MAT276_equilibrium(){
  if (!$("MAT276_n_f")) return;

  const fExpr = $("MAT276_n_f").value.trim();
  const gExpr = $("MAT276_n_g").value.trim();

  let f, g;
  try { f = makeSafeFunction(fExpr); g = makeSafeFunction(gExpr); f(0,0); g(0,0); }
  catch (e) { $("MAT276_n_out").textContent = `Error parsing.\n${e.message}`; return; }

  const xmin=-4, xmax=4, ymin=-4, ymax=4;
  const grid=41, iters=30, tol=1e-9, eps=1e-4;

  const roots = [];
  for (let i=0;i<grid;i++){
    const x0 = xmin + (xmax - xmin) * (i/(grid-1));
    for (let j=0;j<grid;j++){
      const y0 = ymin + (ymax - ymin) * (j/(grid-1));
      const res = newton2D(f, g, x0, y0, iters, tol);
      if (!res) continue;
      if (res.x < xmin-1e-6 || res.x > xmax+1e-6 || res.y < ymin-1e-6 || res.y > ymax+1e-6) continue;
      dedupPush(roots, res, eps);
    }
  }
  roots.sort((p,q) => (p.x - q.x) || (p.y - q.y));

  if (roots.length === 0) {
    $("MAT276_n_out").textContent = "No equilibrium points found.";
    return;
  }

  let out = `Equilibrium points (${roots.length}):\n`;
  for (const r of roots){
    const xs = r.x.toFixed(10).replace(/\.?0+$/,"");
    const ys = r.y.toFixed(10).replace(/\.?0+$/,"");
    out += `(${xs}, ${ys})\n`;
  }
  $("MAT276_n_out").textContent = out.trim();
}

/* Integral (Nerdamer) */
function MAT276_integral(){
  if (!$("MAT276_i_expr")) return;
  const expr = $("MAT276_i_expr").value.trim();
  if (!expr) { $("MAT276_i_out").textContent = "Invalid input."; return; }
  if (typeof nerdamer === "undefined") { $("MAT276_i_out").textContent = "Symbolic engine not available."; return; }

  try {
    const antideriv = nerdamer.integrate(expr, "t").simplify();
    $("MAT276_i_out").textContent = `${antideriv.toString()} + C`;
  } catch (e) {
    $("MAT276_i_out").textContent = `Could not integrate.\n${e.message}`;
  }
}

/* Partial derivatives (Nerdamer) */
function MAT276_partials(){
  if (!$("MAT276_pd_expr")) return;
  const expr = $("MAT276_pd_expr").value.trim();
  if (!expr) { $("MAT276_pd_out").textContent = "Invalid input."; return; }
  if (typeof nerdamer === "undefined") { $("MAT276_pd_out").textContent = "Symbolic engine not available."; return; }

  try {
    const fx = nerdamer.diff(expr, "x").simplify().toString();
    const fy = nerdamer.diff(expr, "y").simplify().toString();
    $("MAT276_pd_out").textContent = `∂f/∂x = ${fx}\n∂f/∂y = ${fy}`;
  } catch (e) {
    $("MAT276_pd_out").textContent = `Could not differentiate.\n${e.message}`;
  }
}

/* =========================
   Button wiring
========================= */
document.addEventListener("click", (ev) => {
  const id = ev.target && ev.target.id;

  if (id === "MAT225_e2_compute") MAT225_eigen2();
  if (id === "MAT225_e3_compute") MAT225_eigen3();

  if (id === "MAT227_q_compute") MAT227_quadratic();
  if (id === "MAT227_l_solve") MAT227_linear2();

  if (id === "MAT276_e2_compute") MAT276_eigen2();
  if (id === "MAT276_l_solve") MAT276_linear2();
  if (id === "MAT276_n_find") MAT276_equilibrium();
  if (id === "MAT276_i_integrate") MAT276_integral();
  if (id === "MAT276_pd_compute") MAT276_partials();
});
</script>
</body>
</html>
