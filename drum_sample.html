<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tongue Drum Builder</title>

<style>
:root{
  --bg:#0b1020; --card:#121a33; --text:#e9eeff; --muted:#aab4e6;
  --line:rgba(255,255,255,.10); --hot:rgba(122,162,255,.55);
}
body{
  margin:0; font-family:system-ui,Segoe UI,Roboto,Arial;
  background:radial-gradient(1000px 600px at 20% 0%, #16204a 0%, var(--bg) 55%);
  color:var(--text);
}
.wrap{max-width:1160px;margin:0 auto;padding:22px;}
h1{margin:0 0 8px;font-size:18px;font-weight:750}
p{margin:0 0 14px;color:var(--muted);line-height:1.35}
.grid{display:grid;grid-template-columns:1.3fr .9fr;gap:14px}
@media (max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:rgba(18,26,51,.9);border:1px solid var(--line);border-radius:16px;padding:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}
.btn{border:1px solid var(--line);background:rgba(122,162,255,.14);color:var(--text);border-radius:12px;padding:9px 12px;cursor:pointer}
.btn:hover{background:rgba(122,162,255,.22)}
.sep{height:1px;background:var(--line);margin:12px 0}
.keys{display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
.oct{margin:12px 0 8px;font-size:12px;color:var(--muted)}
.key{
  user-select:none;
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  cursor:pointer;
  background:rgba(255,255,255,.05);
}
.key.sel{border-color:var(--hot)}
.drumWrap{display:flex;justify-content:center}
svg{max-width:100%}
.tongue{cursor:pointer}
.tongue.off{opacity:.2}
.tongue.playing{filter:brightness(1.3)}
.label{font:700 14px system-ui;fill:#e9eeff}
.labelMuted{font:650 14px system-ui;fill:#aab4e6}
</style>
</head>

<body>
<div class="wrap">
<h1 style="text-align:center; font-size:26px; margin:0 0 10px;">
  Aether Instruments Virtual Tongue Drum
</h1>
<p style="text-align:center; margin:0 0 18px;">
  Please select 10 notes. Press numbers 1 through 0 on the keyboard, or click on the tongues to play the corresponding notes.
</p>


<div class="grid">
<div class="card">
  <div class="row">
    <div class="pill" id="countPill">Selected: 0 / 10</div>
    <button class="btn" id="clear">Clear</button>
    <button class="btn" id="playSeq">Play 1→10</button>
  </div>
  <div class="sep"></div>
  <div id="picker"></div>
</div>

<div class="card">
  <div class="drumWrap" id="drumHost"></div>
</div>
</div>
</div>

<script>
(() => {

const MAX_NOTES=10;
const CHROMA=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const SEMI={"C":0,"C#":1,"D":2,"D#":3,"E":4,"F":5,"F#":6,"G":7,"G#":8,"A":9,"A#":10,"B":11};

// Perimeter placement (pad 2 → pad 10)
const PERIM_ANGLES=[200,160,240,120,280,80,320,40,0];

function noteToMidi(n){
  const m=n.match(/^([A-G]#?)(\d)$/);
  return m?((+m[2]+1)*12+SEMI[m[1]]):null;
}
function midiToFreq(m){return 440*Math.pow(2,(m-69)/12)}

let audio=null;
function hit(freq){
  if(!audio) audio=new AudioContext();
  const o=audio.createOscillator();
  const g=audio.createGain();
  o.frequency.value=freq;
  g.gain.setValueAtTime(0.001,audio.currentTime);
  g.gain.exponentialRampToValueAtTime(0.8,audio.currentTime+.01);
  g.gain.exponentialRampToValueAtTime(0.001,audio.currentTime+1.6);
  o.connect(g).connect(audio.destination);
  o.start(); o.stop(audio.currentTime+1.7);
}

const selectedSet=new Set();
let padNotes=[];

function recomputePads(){
  padNotes=[...selectedSet].sort((a,b)=>noteToMidi(a)-noteToMidi(b)).slice(0,10);
}

const picker=document.getElementById("picker");
const drumHost=document.getElementById("drumHost");
const countPill=document.getElementById("countPill");

function buildPicker(){
  picker.innerHTML="";
  for(let oct=3;oct<=5;oct++){
    const o=document.createElement("div");
    o.className="oct"; o.textContent="Octave "+oct;
    picker.appendChild(o);
    const g=document.createElement("div");
    g.className="keys";
    CHROMA.forEach(n=>{
      const note=n+oct;
      const k=document.createElement("div");
      k.className="key"+(selectedSet.has(note)?" sel":"");
      k.textContent=note;
      k.onclick=()=>{
        selectedSet.has(note)?selectedSet.delete(note):
        selectedSet.size<10&&selectedSet.add(note);
        render();
      };
      g.appendChild(k);
    });
    picker.appendChild(g);
  }
}

function buildDrum(){
  const W=520,c=W/2;
  const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute("viewBox","0 0 520 520");

  const base=document.createElementNS(svg.namespaceURI,"circle");
  base.setAttribute("cx",c);base.setAttribute("cy",c);base.setAttribute("r",235);
  base.setAttribute("fill","rgba(255,255,255,.06)");
  svg.appendChild(base);

  const tongues=[];

  // center pad
  tongues.push({pad:1,x:c,y:c});

  // perimeter pads
  PERIM_ANGLES.forEach((deg,i)=>{
    const rad=deg*Math.PI/180;
    tongues.push({
      pad:i+2,
      x:c+185*Math.sin(rad),
      y:c-185*Math.cos(rad)
    });
  });

  tongues.forEach(t=>{
    const g=document.createElementNS(svg.namespaceURI,"g");
    g.classList.add("tongue");

    const circ=document.createElementNS(svg.namespaceURI,"circle");
    circ.setAttribute("cx",t.x);
    circ.setAttribute("cy",t.y);
    circ.setAttribute("r",t.pad===1?50:38);
    circ.setAttribute("fill","rgba(255,255,255,.12)");
    g.appendChild(circ);

    const lab=document.createElementNS(svg.namespaceURI,"text");
    lab.setAttribute("x",t.x);
    lab.setAttribute("y",t.y+5);
    lab.setAttribute("text-anchor","middle");
    lab.classList.add("labelMuted");
    g.appendChild(lab);

    g.onclick=()=>{
      const n=padNotes[t.pad-1];
      if(n) hit(midiToFreq(noteToMidi(n)));
    };

    t.el=g; t.lab=lab;
    svg.appendChild(g);
  });

  drumHost.innerHTML="";
  drumHost.appendChild(svg);
  return tongues;
}

let tongues=null;

window.addEventListener("keydown", (e) => {
  const tag = (e.target && e.target.tagName || "").toLowerCase();
  if (tag === "input" || tag === "textarea") return;

  const k = e.key;
  let pad = null;

  if (k >= "1" && k <= "9") pad = Number(k);
  else if (k === "0") pad = 10;

  if (!pad) return;

  const n = padNotes[pad - 1];
  if (!n) return;

  hit(midiToFreq(noteToMidi(n)));
});

  
function syncDrum(){
  if(!tongues) tongues=buildDrum();
  tongues.forEach(t=>{
    const n=padNotes[t.pad-1];
    t.lab.textContent=n||"";
    t.lab.setAttribute("class",n?"label":"labelMuted");
  });
}

function render(){
  recomputePads();
  countPill.textContent=`Selected: ${selectedSet.size} / 10`;
  buildPicker();
  syncDrum();
}

document.getElementById("clear").onclick=()=>{
  selectedSet.clear(); render();
};
document.getElementById("playSeq").onclick=async()=>{
  for(const n of padNotes){
    hit(midiToFreq(noteToMidi(n)));
    await new Promise(r=>setTimeout(r,220));
  }
};

render();
})();
</script>
</body>
</html>
